# Makefile pour gÃ©rer l'API Edor avec Docker

.PHONY: help build up down restart logs status clean dev prod

# Aide
help:
	@echo "ğŸš€ Commandes disponibles pour l'API Edor:"
	@echo ""
	@echo "  make build     - Construire l'image Docker"
	@echo "  make up        - DÃ©marrer l'API (production)"
	@echo "  make dev       - DÃ©marrer l'API (dÃ©veloppement)"
	@echo "  make prod      - DÃ©marrer l'API (production avancÃ©e)"
	@echo "  make down      - ArrÃªter l'API"
	@echo "  make restart   - RedÃ©marrer l'API"
	@echo "  make logs      - Voir les logs"
	@echo "  make status    - Voir le statut"
	@echo "  make clean     - Nettoyer les conteneurs et images"
	@echo "  make health    - VÃ©rifier la santÃ© de l'API"
	@echo ""

# Construire l'image
build:
	@echo "ğŸ”¨ Construction de l'image Docker..."
	docker-compose build

# DÃ©marrer en production
up:
	@echo "ğŸš€ DÃ©marrage de l'API en production..."
	docker-compose up -d
	@echo "âœ… API dÃ©marrÃ©e sur http://localhost:8090"

# DÃ©marrer en dÃ©veloppement
dev:
	@echo "ğŸš€ DÃ©marrage de l'API en dÃ©veloppement..."
	docker-compose -f docker-compose.dev.yml up -d
	@echo "âœ… API dÃ©marrÃ©e sur http://localhost:8090"

# DÃ©marrer en production avancÃ©e
prod:
	@echo "ğŸš€ DÃ©marrage de l'API en production avancÃ©e..."
	docker-compose -f docker-compose.prod.yml up -d
	@echo "âœ… API dÃ©marrÃ©e sur http://localhost:8090"

# ArrÃªter
down:
	@echo "ğŸ›‘ ArrÃªt de l'API..."
	docker-compose down

# RedÃ©marrer
restart:
	@echo "ğŸ”„ RedÃ©marrage de l'API..."
	docker-compose restart

# Voir les logs
logs:
	@echo "ğŸ“‹ Logs de l'API:"
	docker-compose logs -f

# Voir le statut
status:
	@echo "ğŸ“Š Statut des conteneurs:"
	docker-compose ps
	@echo ""
	@echo "ğŸ” SantÃ© de l'API:"
	@curl -s http://localhost:8090/health 2>/dev/null || echo "âŒ API non accessible"

# VÃ©rifier la santÃ©
health:
	@echo "ğŸ” VÃ©rification de la santÃ© de l'API..."
	@curl -f http://localhost:8090/health && echo "âœ… API en bonne santÃ©" || echo "âŒ API non accessible"

# Nettoyer
clean:
	@echo "ğŸ§¹ Nettoyage des conteneurs et images..."
	docker-compose down
	docker rmi edor-api 2>/dev/null || true
	docker system prune -f
	@echo "âœ… Nettoyage terminÃ©"
